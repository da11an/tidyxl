<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Parse xlsx (Excel) formulas into tokens — xlex • tidyxl</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Parse xlsx (Excel) formulas into tokens — xlex" />
<meta property="og:description" content="xlex takes an Excel formula and separates it into tokens.  The name is
a bad pun on 'Excel' and 'lexer'.  It returns a dataframe, one row per token,
giving the token itself, its type (e.g.  number, or error), and its
level.
The level is a number to show the depth of a token within nested function
calls.  The token A2 in the formula IF(A1=1,A2,MAX(A3,A4)) is at level 1.
Tokens A3 and A4 are at level 2.  The token IF is at level 0, which is
the outermost level.
The output isn't enough to enable computation or validation of formulas, but
it is enough to investigate the structure of formulas and spreadsheets.  It
has been tested on millions of formulas in the Enron corpus." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-45097885-4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-45097885-4');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidyxl</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/tidyxl.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/data-validation-rules.html">Data Validation Rules</a>
    </li>
    <li>
      <a href="../articles/smells.html">Detecting Spreadsheet Smells with xlex()</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/nacnudus/tidyxl/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Parse xlsx (Excel) formulas into tokens</h1>
    <small class="dont-index">Source: <a href='https://github.com/nacnudus/tidyxl/blob/master/R/xlex.R'><code>R/xlex.R</code></a></small>
    <div class="hidden name"><code>xlex.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>xlex</code> takes an Excel formula and separates it into tokens.  The name is
a bad pun on 'Excel' and 'lexer'.  It returns a dataframe, one row per token,
giving the token itself, its type (e.g.  <code>number</code>, or <code>error</code>), and its
level.</p>
<p>The level is a number to show the depth of a token within nested function
calls.  The token <code>A2</code> in the formula <code>IF(A1=1,A2,MAX(A3,A4))</code> is at level 1.
Tokens <code>A3</code> and <code>A4</code> are at level 2.  The token <code>IF</code> is at level 0, which is
the outermost level.</p>
<p>The output isn't enough to enable computation or validation of formulas, but
it is enough to investigate the structure of formulas and spreadsheets.  It
has been tested on millions of formulas in the Enron corpus.</p>
    </div>

    <pre class="usage"><span class='fu'>xlex</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>Character vector of length 1, giving the formula.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data frame (a tibble, if you use the tidyverse) one row per token,
giving the token itself, its type (e.g.  <code>number</code>, or <code>error</code>), and its
level.</p>
<p>A class attribute <code>xlex</code> is added, so that the <code><a href='https://rdrr.io/r/base/print.html'>base::print()</a></code> generic can be
specialised to print the tree prettily.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The different types of tokens are:</p><ul>
<li><p><code>ref</code> A cell reference/address e.g. <code>A1</code> or <code>$B2:C$14</code>.</p></li>
<li><p><code>sheet</code>A sheet name, e.g. <code>Sheet1!</code> or <code>'My Sheet'!</code>.  If the sheet is
from a different file, then the file is included in this token -- usually
it has been normalized to the form <code>[0]</code>.</p></li>
<li><p><code>name</code> A named range, or more properly a named formula.</p></li>
<li><p><code>function</code> An Excel or user-defined function, e.g. <code>MAX</code> or
<code>_xll.MY_CUSTOM_FUNCTION</code>.  A complete list of official Excel functions is
available in the vector <code><a href='excel_functions.html'>excel_functions</a></code>.</p></li>
<li><p><code>error</code> An error, e.g. <code>#N/A</code> or <code>#REF!</code>.</p></li>
<li><p><code>bool</code> <code>TRUE</code> or <code>FALSE</code> -- note that there are also functions <code>TRUE()</code> and
<code>FALSE()</code>.</p></li>
<li><p><code>number</code> All forms of numbers, e.g. <code>1</code>, <code>1.1</code>, <code>-1</code>, <code>1.2E3</code>.</p></li>
<li><p><code>text</code> Strings inside double quotes, e.g. <code>"Hello, World!"</code>.</p></li>
<li><p><code>operator</code> The usual infix operators, <code><a href='https://rdrr.io/r/base/Arithmetic.html'>+</a></code>, <code><a href='https://rdrr.io/r/base/Arithmetic.html'>-</a></code>, <code><a href='https://rdrr.io/r/base/Arithmetic.html'>*</a></code>, <code><a href='https://rdrr.io/r/base/Arithmetic.html'>/</a></code>, <code><a href='https://rdrr.io/r/base/Arithmetic.html'>^</a></code>, <code>&lt;</code>, <code>&lt;=</code>,
<code>&lt;&gt;</code>, etc.  and also the range operator <code><a href='https://rdrr.io/r/base/Colon.html'>:</a></code> when it is used with ranges
that aren't cell addresses, e.g. <code>INDEX(something):A1</code>. The union operator
<code>,</code> is the same symbol that is used to separate function arguments and
array columns, so it is only tagged <code>operator</code> when it is inside
parentheses that are not function parentheses or array curly braces (see
the examples).</p></li>
<li><p><code>paren_open</code> An open parenthesis <code>(</code> indicating an increase in the level
of nesting, but not directly enclosing function arguments.</p></li>
<li><p><code>paren_close</code> As <code>open</code>, but reducing the level of nesting.</p></li>
<li><p><code>open_array</code> An open curly brace '{' indicating the start of an array
of constants, and an increase in the level of nesting.</p></li>
<li><p><code>close_array</code> As <code>open_array</code>, but ending the array of constants</p></li>
<li><p><code>fun_open</code> An open parenthesis <code>(</code> immediately after a function name,
directly enclosing the function arguments.</p></li>
<li><p><code>fun_close</code> As <code>fun_open</code> but immediately after the function
arguments.</p></li>
<li><p><code>separator</code> A comma <code>,</code> separating function arguments or array
columns, or a semicolon <code>;</code> separating array rows.</p></li>
<li><p><code>DDE</code> A call to a Dynamic Data Exchange server, usually normalized to
the form <code>[1]!'DDE_parameter=1'</code>, but the full form is
<code>'ABCD'|'EFGH'!'IJKL'</code>.</p></li>
<li><p><code>space</code> Some old files haven't stripped formulas of meaningless
spaces. They are returned as <code>space</code> tokens so that the original formula
can always be reconstructed by concatenating all tokens.</p></li>
<li><p><code>other</code> If you see this, then something has gone wrong -- please
report it at https://github.com/nacnudus/tidyxl/issues with a
reproducible example (e.g. using the reprex package).</p></li>
</ul>

<p>Every part of the original formula is returned as a token, so the original
formula can be reconstructed by concatenating the tokens.  If that doesn't
work, please report it at https://github.com/nacnudus/tidyxl/issues with a
reproducible example (e.g. using the reprex package).</p>
<p>The XLParser project was a great help in creating the grammar.
https://github.com/spreadsheetlab/XLParser.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># All explicit cell references/addresses are returned as a single 'ref' token.</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"A1"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root    
#&gt; °-- A1  ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"A$1"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root     
#&gt; °-- A$1  ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"$A1"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root     
#&gt; °-- $A1  ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"$A$1"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root      
#&gt; °-- $A$1  ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"A1:B2"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root       
#&gt; °-- A1:B2  ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"1:1"</span><span class='op'>)</span> <span class='co'># Whole row</span>
</div><div class='output co'>#&gt; root     
#&gt; °-- 1:1  ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"A:B"</span><span class='op'>)</span> <span class='co'># Whole column</span>
</div><div class='output co'>#&gt; root     
#&gt; °-- A:B  ref </div><div class='input'>
<span class='co'># If one part of an address is a name or a function, then the colon ':' is</span>
<span class='co'># regarded as a 'range operator', so is tagged 'operator'.</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"A1:SOME.NAME"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root           
#&gt; ¦-- A1         ref
#&gt; ¦-- :          operator
#&gt; °-- SOME.NAME  name </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"SOME_FUNCTION():B2"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root               
#&gt; ¦-- SOME_FUNCTION  function
#&gt; ¦-- (              fun_open
#&gt; ¦-- )              fun_close
#&gt; ¦-- :              operator
#&gt; °-- B2             ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"SOME_FUNCTION():SOME.NAME"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root               
#&gt; ¦-- SOME_FUNCTION  function
#&gt; ¦-- (              fun_open
#&gt; ¦-- )              fun_close
#&gt; ¦-- :              operator
#&gt; °-- SOME.NAME      name </div><div class='input'>
<span class='co'># Sheet names are recognised by the terminal exclamation mark '!'.</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"Sheet1!A1"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root         
#&gt; ¦-- Sheet1!  sheet
#&gt; °-- A1       ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"'Sheet 1'!A1"</span><span class='op'>)</span>       <span class='co'># Quoted names may contain some punctuation</span>
</div><div class='output co'>#&gt; root            
#&gt; ¦-- 'Sheet 1'!  sheet
#&gt; °-- A1          ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"'It''s a sheet'!A1"</span><span class='op'>)</span> <span class='co'># Quotes are escaped by doubling</span>
</div><div class='output co'>#&gt; root                  
#&gt; ¦-- 'It''s a sheet'!  sheet
#&gt; °-- A1                ref </div><div class='input'>
<span class='co'># Sheets can be ranged together in so-called 'three-dimensional formulas'.</span>
<span class='co'># Both sheets are returned in a single 'sheet' token.</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"Sheet1:Sheet2!A1"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root                
#&gt; ¦-- Sheet1:Sheet2!  sheet
#&gt; °-- A1              ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"'Sheet 1:Sheet 2'!A1"</span><span class='op'>)</span> <span class='co'># Quotes surround both (rather than each) sheet</span>
</div><div class='output co'>#&gt; root                    
#&gt; ¦-- 'Sheet 1:Sheet 2'!  sheet
#&gt; °-- A1                  ref </div><div class='input'>
<span class='co'># Sheets from other files are prefixed by the filename, which Excel</span>
<span class='co'># normalizes the filenames into indexes.  Either way, xlex() includes the</span>
<span class='co'># file/index in the 'sheet' token.</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"[1]Sheet1!A1"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root            
#&gt; ¦-- [1]Sheet1!  sheet
#&gt; °-- A1          ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"'[1]Sheet 1'!A1"</span><span class='op'>)</span> <span class='co'># Quotes surround both the file index and the sheet</span>
</div><div class='output co'>#&gt; root               
#&gt; ¦-- '[1]Sheet 1'!  sheet
#&gt; °-- A1             ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"'C:\\My Documents\\[file.xlsx]Sheet1'!A1"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root                                      
#&gt; ¦-- 'C:\My Documents\[file.xlsx]Sheet1'!  sheet
#&gt; °-- A1                                    ref </div><div class='input'>
<span class='co'># Function names are recognised by the terminal open-parenthesis '('.  There</span>
<span class='co'># is no distinction between custom functions and built-in Excel functions.</span>
<span class='co'># The open-parenthesis is tagged 'fun_open', and the corresponding</span>
<span class='co'># close-parenthesis at the end of the arguments is tagged 'fun_close'.</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"MAX(1,2)"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root       
#&gt; ¦-- MAX    function
#&gt; °-- (      fun_open
#&gt;     ¦-- 1  number
#&gt;     ¦-- ,  separator
#&gt;     °-- 2  number
#&gt; °-- )      fun_close </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"_xll.MY_CUSTOM_FUNCTION()"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root                         
#&gt; ¦-- _xll.MY_CUSTOM_FUNCTION  function
#&gt; ¦-- (                        fun_open
#&gt; °-- )                        fun_close </div><div class='input'>
<span class='co'># Named ranges (properly called 'named formulas') are a last resort after</span>
<span class='co'># attempting to match a function (ending in an open parenthesis '(') or a</span>
<span class='co'># sheet (ending in an exclamation mark '!')</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"MY_NAMED_RANGE"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root                
#&gt; °-- MY_NAMED_RANGE  name </div><div class='input'>
<span class='co'># Some cell addresses/references, functions and names can look alike, but</span>
<span class='co'># xlex() should always make the right choice.</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"XFD1"</span><span class='op'>)</span>     <span class='co'># A cell in the maximum column in Excel</span>
</div><div class='output co'>#&gt; root      
#&gt; °-- XFD1  ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"XFE1"</span><span class='op'>)</span>     <span class='co'># Beyond the maximum column, must be a named range/formula</span>
</div><div class='output co'>#&gt; root      
#&gt; °-- XFE1  name </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"A1048576"</span><span class='op'>)</span> <span class='co'># A cell in the maximum row in Excel</span>
</div><div class='output co'>#&gt; root          
#&gt; °-- A1048576  ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"A1048577"</span><span class='op'>)</span> <span class='co'># Beyond the maximum row, must be a named range/formula</span>
</div><div class='output co'>#&gt; root          
#&gt; °-- A1048577  name </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"LOG10"</span><span class='op'>)</span>    <span class='co'># A cell address</span>
</div><div class='output co'>#&gt; root       
#&gt; °-- LOG10  ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"LOG10()"</span><span class='op'>)</span>  <span class='co'># A log function</span>
</div><div class='output co'>#&gt; root       
#&gt; ¦-- LOG10  function
#&gt; ¦-- (      fun_open
#&gt; °-- )      fun_close </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"LOG:LOG"</span><span class='op'>)</span>  <span class='co'># The whole column 'LOG'</span>
</div><div class='output co'>#&gt; root         
#&gt; °-- LOG:LOG  ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"LOG"</span><span class='op'>)</span>      <span class='co'># Not a cell address, must be a named range/formula</span>
</div><div class='output co'>#&gt; root     
#&gt; °-- LOG  name </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"LOG()"</span><span class='op'>)</span>    <span class='co'># Another log function</span>
</div><div class='output co'>#&gt; root     
#&gt; ¦-- LOG  function
#&gt; ¦-- (    fun_open
#&gt; °-- )    fun_close </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"A1.2!A1"</span><span class='op'>)</span>  <span class='co'># A sheet called 'A1.2'</span>
</div><div class='output co'>#&gt; root       
#&gt; ¦-- A1.2!  sheet
#&gt; °-- A1     ref </div><div class='input'>
<span class='co'># Text is surrounded by double-quotes.</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"\"Some text\""</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root             
#&gt; °-- "Some text"  text </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"\"Some \"\"text\"\"\""</span><span class='op'>)</span> <span class='co'># Double-quotes within text are escaped by</span>
</div><div class='output co'>#&gt; root                 
#&gt; °-- "Some ""text"""  text </div><div class='input'>
<span class='co'># Numbers are signed where it makes sense, and can be scientific</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"1"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root   
#&gt; °-- 1  number </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"1.2"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root     
#&gt; °-- 1.2  number </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"-1"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root    
#&gt; °-- -1  number </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"-1-1"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root    
#&gt; ¦-- -1  number
#&gt; ¦-- -   operator
#&gt; °-- 1   number </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"-1+-1"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root    
#&gt; ¦-- -1  number
#&gt; ¦-- +   operator
#&gt; °-- -1  number </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"MAX(-1-1)"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root       
#&gt; ¦-- MAX    function
#&gt; °-- (      fun_open
#&gt;     ¦-- -  operator
#&gt;     ¦-- 1  number
#&gt;     ¦-- -  operator
#&gt;     °-- 1  number
#&gt; °-- )      fun_close </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"-1.2E-3"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root         
#&gt; °-- -1.2E-3  number </div><div class='input'>
<span class='co'># Booleans can be constants or functions, and names can look like booleans,</span>
<span class='co'># but xlex() should always make the right choice.</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"TRUE"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root      
#&gt; °-- TRUE  bool </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"TRUEISH"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root         
#&gt; °-- TRUEISH  name </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"TRUE!A1"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root       
#&gt; ¦-- TRUE!  sheet
#&gt; °-- A1     ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"TRUE()"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root      
#&gt; ¦-- TRUE  function
#&gt; ¦-- (     fun_open
#&gt; °-- )     fun_close </div><div class='input'>
<span class='co'># Errors are tagged 'error'</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"#DIV/0!"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root         
#&gt; °-- #DIV/0!  error </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"#N/A"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root      
#&gt; °-- #N/A  error </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"#NAME?"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root        
#&gt; °-- #NAME?  error </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"#NULL!"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root        
#&gt; °-- #NULL!  error </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"#NUM!"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root       
#&gt; °-- #NUM!  error </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"#REF!"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root       
#&gt; °-- #REF!  error </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"#VALUE!"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root         
#&gt; °-- #VALUE!  error </div><div class='input'>
<span class='co'># Operators with more than one character are treated as single tokens</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"1&lt;&gt;2"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root    
#&gt; ¦-- 1   number
#&gt; ¦-- &lt;&gt;  operator
#&gt; °-- 2   number </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"1&lt;=2"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root    
#&gt; ¦-- 1   number
#&gt; ¦-- &lt;=  operator
#&gt; °-- 2   number </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"1&lt;2"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root   
#&gt; ¦-- 1  number
#&gt; ¦-- &lt;  operator
#&gt; °-- 2  number </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"1=2"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root   
#&gt; ¦-- 1  number
#&gt; ¦-- =  operator
#&gt; °-- 2  number </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"1&amp;2"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root   
#&gt; ¦-- 1  number
#&gt; ¦-- &amp;  operator
#&gt; °-- 2  number </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"1 2"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root   
#&gt; ¦-- 1  number
#&gt; ¦--    operator
#&gt; °-- 2  number </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"(1,2)"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root       
#&gt; °-- (      paren_open
#&gt;     ¦-- 1  number
#&gt;     ¦-- ,  operator
#&gt;     °-- 2  number
#&gt; °-- )      paren_close </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"1%"</span><span class='op'>)</span>   <span class='co'># postfix operator</span>
</div><div class='output co'>#&gt; root   
#&gt; ¦-- 1  number
#&gt; °-- %  operator </div><div class='input'>
<span class='co'># The union operator is a comma ',', which is the same symbol that is used</span>
<span class='co'># to separate function arguments or array columns.  It is tagged 'operator'</span>
<span class='co'># only when it is inside parentheses that are not function parentheses or</span>
<span class='co'># array curly braces.  The curly braces are tagged 'array_open' and</span>
<span class='co'># 'array_close'.</span>
<span class='fu'>tidyxl</span><span class='fu'>::</span><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"A1,B2"</span><span class='op'>)</span> <span class='co'># invalid formula, defaults to 'union' to avoid a crash</span>
</div><div class='output co'>#&gt; root    
#&gt; ¦-- A1  ref
#&gt; ¦-- ,   operator
#&gt; °-- B2  ref </div><div class='input'><span class='fu'>tidyxl</span><span class='fu'>::</span><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"(A1,B2)"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root        
#&gt; °-- (       paren_open
#&gt;     ¦-- A1  ref
#&gt;     ¦-- ,   operator
#&gt;     °-- B2  ref
#&gt; °-- )       paren_close </div><div class='input'><span class='fu'>tidyxl</span><span class='fu'>::</span><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"MAX(A1,B2)"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root        
#&gt; ¦-- MAX     function
#&gt; °-- (       fun_open
#&gt;     ¦-- A1  ref
#&gt;     ¦-- ,   separator
#&gt;     °-- B2  ref
#&gt; °-- )       fun_close </div><div class='input'><span class='fu'>tidyxl</span><span class='fu'>::</span><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"SMALL((A1,B2),1)"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root            
#&gt; ¦-- SMALL       function
#&gt; °-- (           fun_open
#&gt;     °-- (       paren_open
#&gt;         ¦-- A1  ref
#&gt;         ¦-- ,   operator
#&gt;         °-- B2  ref
#&gt;     ¦-- )       paren_close
#&gt;     ¦-- ,       separator
#&gt;     °-- 1       number
#&gt; °-- )           fun_close </div><div class='input'>
<span class='co'># Function arguments are separated by commas ',', which are tagged</span>
<span class='co'># 'separator'.</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"MAX(1,2)"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root       
#&gt; ¦-- MAX    function
#&gt; °-- (      fun_open
#&gt;     ¦-- 1  number
#&gt;     ¦-- ,  separator
#&gt;     °-- 2  number
#&gt; °-- )      fun_close </div><div class='input'>
<span class='co'># Nested functions are marked by an increase in the 'level'.  The level</span>
<span class='co'># increases inside parentheses, rather than at the parentheses.  Curly</span>
<span class='co'># braces, for arrays, have the same behaviour, as do subexpressions inside</span>
<span class='co'># ordinary parenthesis, tagged 'paren_open' and 'paren_close'.  To see the</span>
<span class='co'># levels explicitly (rather than by the pretty printing), print as a normal</span>
<span class='co'># data frame or tibble by specifying `pretty = FALSE`.</span>
<span class='co'># class with as.data.frame.</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"MAX(MIN(1,2),3)"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root           
#&gt; ¦-- MAX        function
#&gt; °-- (          fun_open
#&gt;     ¦-- MIN    function
#&gt;     °-- (      fun_open
#&gt;         ¦-- 1  number
#&gt;         ¦-- ,  separator
#&gt;         °-- 2  number
#&gt;     ¦-- )      fun_close
#&gt;     ¦-- ,      separator
#&gt;     °-- 3      number
#&gt; °-- )          fun_close </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"{1,2;3,4}"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root       
#&gt; °-- {      open_array
#&gt;     ¦-- 1  number
#&gt;     ¦-- ,  separator
#&gt;     ¦-- 2  number
#&gt;     ¦-- ;  separator
#&gt;     ¦-- 3  number
#&gt;     ¦-- ,  separator
#&gt;     °-- 4  number
#&gt; °-- }      close_array </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"1*(2+3)"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root       
#&gt; ¦-- 1      number
#&gt; ¦-- *      operator
#&gt; °-- (      paren_open
#&gt;     ¦-- 2  number
#&gt;     ¦-- +  operator
#&gt;     °-- 3  number
#&gt; °-- )      paren_close </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"1*(2+3)"</span><span class='op'>)</span>, pretty <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span style='color: #555555;'># A tibble: 7 x 3</span><span>
#&gt;   level type        token
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;int&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span>     0 number      1    
#&gt; </span><span style='color: #555555;'>2</span><span>     0 operator    *    
#&gt; </span><span style='color: #555555;'>3</span><span>     0 paren_open  (    
#&gt; </span><span style='color: #555555;'>4</span><span>     1 number      2    
#&gt; </span><span style='color: #555555;'>5</span><span>     1 operator    +    
#&gt; </span><span style='color: #555555;'>6</span><span>     1 number      3    
#&gt; </span><span style='color: #555555;'>7</span><span>     0 paren_close )    </div><div class='input'>
<span class='co'># Arrays are marked by opening and closing curly braces, with comma ','</span>
<span class='co'># between columns, and semicolons ';' between rows  Commas and semicolons are</span>
<span class='co'># both tagged 'separator'.  Arrays contain only constants, which are</span>
<span class='co'># booleans, numbers, text, and errors.</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"MAX({1,2;3,4})"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root           
#&gt; ¦-- MAX        function
#&gt; °-- (          fun_open
#&gt;     °-- {      open_array
#&gt;         ¦-- 1  number
#&gt;         ¦-- ,  separator
#&gt;         ¦-- 2  number
#&gt;         ¦-- ;  separator
#&gt;         ¦-- 3  number
#&gt;         ¦-- ,  separator
#&gt;         °-- 4  number
#&gt;     °-- }      close_array
#&gt; °-- )          fun_close </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"=MAX({-1E-2,TRUE;#N/A,\"Hello, World!\"})"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root                         
#&gt; ¦-- =                        operator
#&gt; ¦-- MAX                      function
#&gt; °-- (                        fun_open
#&gt;     °-- {                    open_array
#&gt;         ¦-- -1E-2            number
#&gt;         ¦-- ,                separator
#&gt;         ¦-- TRUE             bool
#&gt;         ¦-- ;                separator
#&gt;         ¦-- #N/A             error
#&gt;         ¦-- ,                separator
#&gt;         °-- "Hello, World!"  text
#&gt;     °-- }                    close_array
#&gt; °-- )                        fun_close </div><div class='input'>
<span class='co'># Structured references are surrounded by square brackets.  Subexpressions</span>
<span class='co'># may also be surrounded by square brackets, but xlex() returns the whole</span>
<span class='co'># expression in a single 'structured_ref' token.</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"[@col2]"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root         
#&gt; °-- [@col2]  structured_ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"SUM([col22])"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root             
#&gt; ¦-- SUM          function
#&gt; °-- (            fun_open
#&gt;     °-- [col22]  structured_ref
#&gt; °-- )            fun_close </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"Table1[col1]"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root              
#&gt; °-- Table1[col1]  structured_ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"Table1[[col1]:[col2]]"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root                       
#&gt; °-- Table1[[col1]:[col2]]  structured_ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"Table1[#Headers]"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root                  
#&gt; °-- Table1[#Headers]  structured_ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"Table1[[#Headers],[col1]]"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root                           
#&gt; °-- Table1[[#Headers],[col1]]  structured_ref </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"Table1[[#Headers],[col1]:[col2]]"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root                                  
#&gt; °-- Table1[[#Headers],[col1]:[col2]]  structured_ref </div><div class='input'>
<span class='co'># DDE calls (Dynamic Data Exchange) are normalized by Excel into indexes.</span>
<span class='co'># Either way, xlex() includes everything in one token.</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"[1]!'DDE_parameter=1'"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root                       
#&gt; °-- [1]!'DDE_parameter=1'  DDE </div><div class='input'><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"'Quote'|'NYSE'!ZAXX"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root                     
#&gt; °-- 'Quote'|'NYSE'!ZAXX  DDE </div><div class='input'><span class='co'># Meaningless spaces that appear in some old files are returned as 'space'</span>
<span class='co'># tokens, so that the original formula can still be recovered by</span>
<span class='co'># concatenating all the tokens.  Spaces between function names and their open</span>
<span class='co'># parenthesis have not been observed, so are not permitted.</span>
<span class='fu'>xlex</span><span class='op'>(</span><span class='st'>" MAX( A1 ) "</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root        
#&gt; ¦--         operator
#&gt; ¦-- MAX     function
#&gt; °-- (       fun_open
#&gt;     ¦--     operator
#&gt;     ¦-- A1  ref
#&gt;     °--     operator
#&gt; ¦-- )       fun_close
#&gt; °--         operator </div><div class='input'>
<span class='co'># print.xlex() invisibly returns the original argument, so that it can be</span>
<span class='co'># used in magrittr pipelines.</span>
<span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'>xlex</span><span class='op'>(</span><span class='st'>"ROUND(A1*2"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; root        
#&gt; ¦-- ROUND   function
#&gt; °-- (       fun_open
#&gt;     ¦-- A1  ref
#&gt;     ¦-- *   operator
#&gt;     °-- 2   number 
#&gt; tibble [5 × 3] (S3: xlex/tbl_df/tbl/data.frame)
#&gt;  $ level: int [1:5] 0 0 1 1 1
#&gt;  $ type : chr [1:5] "function" "fun_open" "ref" "operator" ...
#&gt;  $ token: chr [1:5] "ROUND" "(" "A1" "*" ...</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Duncan Garmonsway.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


